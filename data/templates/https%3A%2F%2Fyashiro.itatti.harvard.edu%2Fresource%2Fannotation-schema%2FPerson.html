<rs-text-annotation-type 
    label="Person"
    rdf-type='https://yashiro.itatti.harvard.edu/yashiro/annotation-schema/Person'
    icon-url='/images/dpub/actor.svg'
    color="#F9690E">

    <template id='annotation'>
      <div style="display: flex; flex-direction: column;"> 
      <semantic-query 
            query='SELECT DISTINCT ?value ?label WHERE {
                BIND({{iri}} as ?iri)
                ?iri oa:hasBody ?body.
                ?body crm:P1_is_identified_by ?value.
                ?value rdfs:label ?label 
            }' template='{{> show}}'>
            <template id='show'>
               <style>

              .yashiro-annotation-content.concept{
                margin-bottom: 0px !important;
              }

            </style>
              <div class="yashiro-annotation-content concept">
                <semantic-query
                query='SELECT DISTINCT ?localImage WHERE {<{{bindings.0.value.value}}> crm:P138i_has_representation ?filename.
                  BIND(REPLACE(STR(?filename),"https://yashiro.itatti.harvard.edu/","/assets/") as ?localImageNorm)
                  BIND(REPLACE(?localImageNorm,"/assets/resource/assets/","/assets/") as ?localImage) }LIMIT 1'
                template='{{> thumbTemplate }}'>
                <template id='thumbTemplate'>
                  {{#each bindings}}
                    <img class="person-img" height="60px" src="{{localImage.value}}"/>
                  {{/each}}
                </template>
              </semantic-query>
                {{#> yashiro:AnnotationTemplate}}
                    <span>Person:</span>
                    <semantic-link iri="{{bindings.0.value.value}}">{{bindings.0.label.value}}</semantic-link>
                {{/ yashiro:AnnotationTemplate}}
                 </div>
                <div style="display: flex; align-items: center;">
                  <semantic-query
                        query='SELECT DISTINCT ?info WHERE { <{{bindings.0.value.value}}>  <http://www.cidoc-crm.org/cidoc-crm/P70i_is_documented_in> ?subtitle_node .
                        ?subtitle_node rdf:value ?info .}LIMIT 10'
                        template='{{> documentedIn }}'>
                    <template id='documentedIn'>
                      {{#each bindings}}
                        <div  class="annotation-subtitle">{{info.value}}</div>
                      {{/each}}
                    </template>
                  </semantic-query>
                </div>
            </template>
        </semantic-query>

      </div>
    </template>
      <semantic-form-composite-input
          for='oaHasBody'
          new-subject-template='body'
          fields='[[fieldDefinitions 
              annotation_person="https://y.itatti.harvard.edu/container/fieldDefinitionContainer/annotation_person"
              annotation_type="https://y.itatti.harvard.edu/container/fieldDefinitionContainer/annotation_type"
              annotation_label="https://y.itatti.harvard.edu/container/fieldDefinitionContainer/annotation_label"
          ]]'>
          <semantic-form-autocomplete-input for="annotation_person"></semantic-form-autocomplete-input>
          <semantic-form-hidden-input for='annotation_label' append-value='[[singleValueFromSelect "SELECT ?user WHERE { BIND(?__useruri__ as ?user) }" ]]'></semantic-form-hidden-input>
          <semantic-form-hidden-input for='annotation_type' default-value='https://yashiro.itatti.harvard.edu/yashiro/annotation-schema/Person'></semantic-form-hidden-input>
    </semantic-form-composite-input>
</rs-text-annotation-type>



<!--
[[fieldDefinitions ]]
  <semantic-form-composite-input
          for='oaHasBody'
          new-subject-template='body'
          fields='[
              {
                "id": "type",
                "xsdDatatype": "xsd:anyURI",
                "selectPattern": "SELECT $value WHERE { $subject rdf:type $value }",
                "insertPattern": "INSERT { $subject rdf:type $value } WHERE {}",
                "deletePattern": "DELETE { $subject rdf:type $value } WHERE {}"
              },
              {
                "id": "uri",
                "label": "Person",
                "description": "Person name",
                "xsdDatatype": "xsd:anyURI",
                "minOccurs": "1",
                "maxOccurs": "1",
                "selectPattern": "SELECT $value WHERE { $subject rdfs:label $value }",
                "insertPattern": "INSERT { $subject crm:P1_is_identified_by $value } WHERE {}",
                "deletePattern": "DELETE { $subject rdfs:label $value } WHERE {}",
                "autosuggestionPattern": "SELECT ?value ?label WHERE { ?value rdf:type crm:E21_Person. ?value crm:P1_is_identified_by ?person. ?person rdfs:label ?label. FILTER REGEX(STR(?label), \"?token\") } LIMIT 10"
              },
              {
                "id": "label",
                "label": "Label",
                "description": "Label",
                "xsdDatatype": "rdf:langString",
                "minOccurs": "1",
                "maxOccurs": "1",
                "selectPattern": "SELECT $value WHERE { $subject rdfs:label $value }",
                "insertPattern": "INSERT { $subject rdfs:label $value } WHERE {}",
                "deletePattern": "DELETE { $subject rdfs:label $value } WHERE {}"
              }
            ]'>

    <semantic-form-hidden-input for='type' default-value='https://yashiro.itatti.harvard.edu/yashiro/annotation-schema/Person'></semantic-form-hidden-input>

    
    <semantic-form-autocomplete-input for='uri'></semantic-form-autocomplete-input>

    <semantic-form-hidden-input for='label' append-value='[[singleValueFromSelect "SELECT ?user WHERE { BIND(?__useruri__ as ?user) }" ]]'>
    </semantic-form-hidden-input>
        

  </semantic-form--input>
    <semantic-form-errors></semantic-form-errors>
  </semantic-form-composite-input>
  -->