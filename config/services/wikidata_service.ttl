
PREFIX sp: <http://spinrdf.org/sp#>
PREFIX spin: <http://spinrdf.org/spin#>
PREFIX spl: <http://spinrdf.org/spl#>
PREFIX : <http://www.researchspace.org/resource/system/service/custom#>
PREFIX rssqlsail: <http://www.researchspace.org/resource/system/sql#>
PREFIX ephedra: <http://www.researchspace.org/resource/system/ephedra#>

:wikidata a ephedra:Service ;
	<http://www.openrdf.org/config/sail#sailType> "researchspace:SQL" ;
	rdfs:label "A wrapper for the Wikidata service." ;
	ephedra:hasSPARQLPattern (
		[
			sp:subject :_results ;
			sp:predicate :hasAction ;
			sp:object :_action
		]
		[
			sp:subject :_results ;
			sp:predicate :hasFormat ;
			sp:object :_format
		]
		[
			sp:subject :_results ;
			sp:predicate :hasSites ;
			sp:object :_sites
		]
		[
			sp:subject :_results ;
			sp:predicate :hasTitles ;
			sp:object :_titles
		]
		[
			sp:subject :_results ;
			sp:predicate :hasProps ;
			sp:object :_props
		]
		[
			sp:subject :_results ;
			sp:predicate :hasLanguages ;
			sp:object :_languages
		]
		[
			sp:subject :_results ;
			sp:predicate :hasId ;
			sp:object :_id
		]
		[
			sp:subject :_results ;
			sp:predicate :hasLabels ;
			sp:object :_labels
		]
		[
			sp:subject :_results ;
			sp:predicate :hasDescriptions ;
			sp:object :_descriptions
		]
	) ;

	spin:constraint
	[
		a spl:Argument ;
		rdfs:comment "" ;
		spl:predicate :_action ;
		spl:valueType xsd:string;
    spl:defaultValue "wbgetentities"
  ] ;

  spin:constraint
	[
		a spl:Argument ;
		rdfs:comment "" ;
		spl:predicate :_format ;
		spl:valueType xsd:string ;
    spl:defaultValue "json" 
  ] ;

  spin:constraint
	[
		a spl:Argument ;
		rdfs:comment "" ;
		spl:predicate :_sites ;
		spl:valueType xsd:string ;
    spl:defaultValue "enwiki"
  ] ;

  spin:constraint
	[
		a spl:Argument ;
		rdfs:comment "" ;
		spl:predicate :_titles ;
		spl:valueType xsd:string
  ] ;

  spin:constraint
	[
		a spl:Argument ;
		rdfs:comment "" ;
		spl:predicate :_props ;
		spl:valueType xsd:string ;
    spl:defaultValue "descriptions|labels"
  ] ;

  spin:constraint
	[
		a spl:Argument ;
		rdfs:comment "" ;
		spl:predicate :_languages ;
		spl:valueType xsd:string ;
    spl:defaultValue "en"
  ] ;


	spin:column
	[
		a spin:Column ;
		rdfs:comment "Row index: will be assigned a random blank node" ;
		spl:predicate :_results ;
		spl:valueType rdfs:Resource;
    ephedra:jsonPath "$.entities[*]"
	] ;

	spin:column [
		a spin:Column ;
		rdfs:comment "" ;
		spl:predicate :_descriptions ;
		spl:valueType xsd:string;
    ephedra:jsonPath "$.descriptions.en.value"
	] ;

  spin:column [
		a spin:Column ;
		rdfs:comment "" ;
		spl:predicate :_labels ;
		spl:valueType xsd:string;
    ephedra:jsonPath "$.labels.en.value"
	] ;

	spin:column [
		a spin:Column ;
		rdfs:comment "" ;
		spl:predicate :_id ;
		spl:valueType xsd:string;
    ephedra:jsonPath "$.id"
	] .
